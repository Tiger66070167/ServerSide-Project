/* ============================================= */
/*          /public/css/kanban.css (Refactored)    */
/* ============================================= */

/* --- General Layout & Background --- */
body {
    overflow-x: hidden; 
}
.kanban-container {
    padding: 20px;
    max-width: 100%;
    height: calc(100vh - 80px); /* 80px คือความสูงของ Header โดยประมาณ */
    display: flex;
    flex-direction: column;
}

/* --- Kanban Header --- */
.kanban-header {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}
.kanban-header h1 { color: var(--secondary-color); }
.task-description { color: #6c757d; }
.kanban-meta { display: flex; flex-wrap: wrap; gap: 20px; margin: 15px 0; font-size: 14px; }
.kanban-meta span { display: flex; align-items: center; gap: 8px; background-color: #e9ecef; padding: 5px 10px; border-radius: 15px; }


/* --- Kanban Board & Custom Scrollbar --- */
.kanban-board {
    display: flex;
    gap: 15px;
    align-items: flex-start;
    overflow-x: auto;
    padding-bottom: 15px;
    flex-grow: 1;
}
.kanban-board::-webkit-scrollbar { height: 12px; }
.kanban-board::-webkit-scrollbar-track { background: #e9ecef; border-radius: 10px; }
.kanban-board::-webkit-scrollbar-thumb { background-color: #ced4da; border-radius: 10px; border: 3px solid #e9ecef; }
.kanban-board::-webkit-scrollbar-thumb:hover { background-color: #adb5bd; }

/******************BUG***************/
/**************DO NOT USE***************/
/* .kanban-board-wrapper {
    overflow-x: auto;
    flex-grow: 1;
} */
 /* ********************************** */

/* --- Kanban List (Column) --- */
.kanban-list {
    flex: 0 0 300px;
    background-color: #f0f2f5;
    border-radius: 12px;
    padding: 8px;
    display: flex;
    flex-direction: column;
    max-height: 100%;
}
.list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 8px;
    margin-bottom: 8px; /* เพิ่มระยะห่างจาก card แรก */
}
.list-title {
    font-weight: 600;
    color: var(--secondary-color);
    padding: 0; /* ลบ padding ที่ซ้ำซ้อนออก */
    flex-grow: 1;
}
.list-actions-btn {
    background: none; border: none; color: #6c757d; cursor: pointer; padding: 5px; border-radius: 5px;
}
.list-actions-btn:hover { background-color: #dcdfe4; }


/* --- Kanban Card --- */
.list-cards {
    flex-grow: 1;
    overflow-y: auto;
    padding: 0 8px;
    min-height: 10px; /* ลดขนาดลง เพราะไม่จำเป็นต้องใหญ่มาก */
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.list-cards::-webkit-scrollbar { width: 0 !important; }

.kanban-card {
    background-color: var(--card-background);
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    cursor: grab;
    font-size: 15px;
    word-wrap: break-word;
    transition: all 0.2s ease-in-out;
    position: relative; /* สำคัญสำหรับจัดวางองค์ประกอบลูก */

    /* ⭐️⭐️⭐️ จุดแก้ไขสำคัญ ⭐️⭐️⭐️ */
    padding: 12px 12px 12px 50px; /* บน:12, ขวา:12, ล่าง:12, ซ้าย:50 */
    min-height: 50px; /* กำหนดความสูงขั้นต่ำให้ card ดูดี */
    display: flex; /* ใช้ flexbox เพื่อจัดวาง description ให้อยู่กึ่งกลางแนวตั้ง */
    align-items: center;
}
.kanban-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}
.kanban-card.sortable-ghost { background: #e0eaff; }

/* --- Card Toggle Button Styles --- */
.card-toggle-btn {
    background-color: transparent;
    border: 2px solid #dfe1e6; /* ขอบสีเทาอ่อน */
    border-radius: 50%; /* ทำให้เป็นวงกลม */
    width: 24px;
    height: 24px;
    padding: 0;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    position: absolute; /* ย้ายมาไว้ข้างหน้าข้อความ */
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
}
.card-toggle-btn i {
    color: transparent; /* ซ่อนไอคอนเริ่มต้น */
    font-size: 14px;
}

/* --- Hover & Done States for Card Toggle --- */
.kanban-card:not(.done):hover .card-toggle-btn {
    border-color: #c1c7d0;
    background-color: #f4f5f7;
}
.kanban-card:not(.done):hover .card-toggle-btn i {
    color: #42526e; /* แสดงไอคอนจางๆ ตอน hover */
}

.kanban-card.done .card-toggle-btn {
    background-color: #28a745; /* สีเขียวเมื่อเสร็จ */
    border-color: #28a745;
}
.kanban-card.done .card-toggle-btn i {
    color: white; /* ไอคอนเครื่องหมายถูกสีขาว */
}


/* Card Actions (ปุ่มที่ซ่อนอยู่) */
.card-actions {
    position: absolute; top: 5px; right: 5px; display: none; background: rgba(255,255,255,0.8); border-radius: 5px;
}
.kanban-card:hover .card-actions { display: flex; }
.card-action-btn { background: none; border: none; cursor: pointer; font-size: 14px; padding: 5px; color: #495057; }
.card-action-btn:hover { color: var(--primary-color); }
.card-action-btn.delete:hover { color: #dc3545; }
.card-description { white-space: pre-wrap; word-break: break-word; }

/* --- New Add Card Composer & Button --- */
.add-card-button {
    background: none; border: none; border-radius: 8px; color: #5e6c84; cursor: pointer; display: block; width: 100%; text-align: left; padding: 8px; margin-top: 8px;
}
.add-card-button:hover { background-color: #dcdfe4; }
.add-card-button i { margin-right: 5px; }

.add-card-composer {
    display: none; /* ซ่อนไว้เป็นค่าเริ่มต้น */
    margin-top: 8px;
}
.add-card-composer textarea {
    width: 100%; min-height: 80px; border: none; border-radius: 8px; padding: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); resize: vertical; margin-bottom: 8px; font-size: 15px;
}
.composer-actions { display: flex; align-items: center; gap: 8px; }
.composer-actions button.add { background-color: var(--primary-color); color: white; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer; font-weight: 500; }
.composer-actions button.add:hover { background-color: var(--secondary-color); }
.composer-actions button.cancel { background: none; border: none; font-size: 24px; line-height: 1; cursor: pointer; color: #6c757d; padding: 5px; }
.composer-actions button.cancel:hover { color: #333; }


/* --- Add New List Form --- */
.add-new-list {
    background-color: rgba(240, 242, 245, 0.7);
}
.add-new-list form {
    display: flex; flex-direction: column; gap: 8px;
}
.add-new-list form input {
    width: 100%; border: none; background: #e2e4e9; border-radius: 8px; padding: 12px; box-sizing: border-box; font-size: 15px;
}
.add-new-list form input::placeholder { color: #555; }
.add-new-list form button {
    background-color: rgba(0,0,0,0.1); color: #172b4d; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer; font-weight: 500;
}
.add-new-list form button:hover { background-color: rgba(0,0,0,0.15); }

.list-header {
    position: relative; /* ทำให้ dropdown อ้างอิงตำแหน่งได้ */
}
.list-actions-menu {
    position: absolute;
    top: 100%; /* แสดงผลใต้ปุ่ม ... */
    right: 0;
    background-color: var(--card-background);
    border-radius: 8px;
    box-shadow: var(--shadow);
    z-index: 10;
    width: 150px;
    display: none; /* ซ่อนไว้เป็นค่าเริ่มต้น */
}
.list-actions-menu.show {
    display: block;
}
.list-actions-menu button {
    display: block;
    width: 100%;
    text-align: left;
    background: none;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
}
.list-actions-menu button:hover {
    background-color: #f0f2f5;
}
.list-actions-menu button.delete {
    color: #dc3545;
}

/* --- Done State for Cards --- */
.kanban-card.done {
    opacity: 0.7;
    background-color: #f8f9fa; /* สีพื้นหลังจางๆ */
}
.kanban-card.done .card-description {
    text-decoration: line-through;
    color: #6c757d;
}
/* ซ่อนปุ่ม edit/delete และปิดการลากเมื่อ done */
.kanban-card.done .card-actions {
    display: none;
}
.kanban-card.done {
    cursor: default;
}

/* ซ่อนทุกอย่างยกเว้น title เมื่อ list done */
/* --- Done State for Lists (เวอร์ชันปรับปรุง) --- */
.kanban-list.done {
    background-color: #e9ecef; /* สีพื้นหลังที่จางลง */
    opacity: 0.8;
}

/* ทำให้ปุ่มต่างๆ ใน header ของ list ใช้งานไม่ได้ */
.kanban-list.done .list-actions button {
    pointer-events: none; /* ปิดการคลิก */
    opacity: 0.5;
}

/* ทำให้ฟอร์ม Add Card ใช้งานไม่ได้ */
.kanban-list.done .add-card-composer,
.kanban-list.done .add-card-button {
    display: none; /* ซ่อนฟอร์มไปเลย */
}

/* เพิ่มข้อความ "COMPLETED" เข้าไป */
.kanban-list.done .list-header::after {
    content: 'COMPLETED';
    background-color: #28a745; /* สีเขียว */
    color: white;
    font-size: 10px;
    font-weight: bold;
    padding: 3px 8px;
    border-radius: 10px;
    margin-left: 10px;
}

.kanban-header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
}
.kanban-header h1 { margin-bottom: 0; }

.complete-task-button {
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s;
    flex-shrink: 0; /* ป้องกันปุ่มหด */
}
.complete-task-button:hover:not(:disabled) {
    background-color: #218838;
}
.complete-task-button:disabled {
    background-color: #a5d6a7;
    cursor: not-allowed;
}
.complete-task-button i { margin-right: 8px; }

/* --- List Actions & Complete Button --- */
.list-actions {
    display: flex;
    align-items: center;
    gap: 5px;
}
.complete-list-btn {
    background: none;
    border: 1px solid #c1c7d0; /* ขอบสีเทา */
    color: #c1c7d0; /* ไอคอนสีเทา */
    border-radius: 5px;
    padding: 4px 6px;
    cursor: not-allowed;
    opacity: 0.6;
    transition: all 0.3s ease;
}

/* --- Enabled State for Complete List Button --- */
.complete-list-btn:not(:disabled) {
    background-color: #28a745;
    border-color: #28a745;
    color: white;
    cursor: pointer;
    opacity: 1;
}
.complete-list-btn:not(:disabled):hover {
    box-shadow: 0 0 10px rgba(40, 167, 69, 0.5); /* เอฟเฟกต์เงาเรืองแสง */
    transform: scale(1.05);
}

/* --- Kanban Search Bar --- */
.kanban-search {
    position: relative;
    margin-bottom: 20px;
    max-width: 400px; /* จำกัดความกว้างของช่องค้นหา */
}

.kanban-search i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
}

#list-search-input {
    width: 100%;
    padding: 10px 15px 10px 40px; /* เว้นที่ด้านซ้ายให้ไอคอน */
    border: 1px solid var(--border-color);
    border-radius: 20px; /* ทำให้ขอบมนสวยงาม */
    font-size: 15px;
    transition: all 0.2s ease-in-out;
}
#list-search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
}

/* --- No Results Message --- */
#no-results-message {
    width: 100%;
    text-align: center;
    padding: 40px;
    color: #6c757d;
}
#no-results-message h3 {
    margin: 0 0 10px 0;
}

/* --- Kanban Header Actions --- */
.kanban-main-actions { display: flex; align-items: center; gap: 10px; }
.icon-button { background: #f0f2f5; border: 1px solid #dfe1e6; color: #42526e; border-radius: 5px; padding: 8px 10px; cursor: pointer; }
.icon-button:hover { background: #e2e4e9; }

/* --- Progress Tracker --- */
.progress-tracker { display: flex; align-items: center; gap: 8px; background-color: #e9ecef; padding: 5px 10px; border-radius: 15px; font-weight: 500; }
.progress-tracker i { color: var(--primary-color); }

/* --- Quick Actions --- */
.quick-action { display: flex; align-items: center; gap: 8px; }
.quick-action label { font-weight: 500; color: #5e6c84; }
.quick-action select { font-size: 14px; border: 1px solid transparent; border-radius: 5px; padding: 4px; background-color: #e9ecef; }
.quick-action select:hover { border-color: #c1c7d0; }
